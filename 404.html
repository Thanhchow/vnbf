<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thông tin VNBF</title>
    <style>
        body { font-family: sans-serif; background: #eee; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; max-width: 400px; width: 100%; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
        .debug-box { background: #333; color: #0f0; padding: 10px; margin-top: 20px; text-align: left; font-size: 12px; border-radius: 5px; overflow-wrap: break-word; font-family: monospace; display: none; }
        img { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; background: #ddd; margin-bottom: 15px; }
        .name { margin: 0; font-size: 22px; color: #333; }
        .role { display: inline-block; padding: 4px 12px; border-radius: 15px; background: #e3f2fd; color: #1976d2; font-weight: bold; font-size: 14px; margin: 5px 0 15px 0; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="card">
        <div id="loading">
            <h3>Đang tải dữ liệu...</h3>
            <p>Vui lòng chờ giây lát.</p>
        </div>

        <div id="profile" class="hidden">
            <img id="p-img" src="" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
            <h2 id="p-name" class="name"></h2>
            <span id="p-role" class="role"></span>
            <p><strong>ID:</strong> <span id="p-id"></span></p>
            <p><strong>Đơn vị:</strong> <span id="p-unit"></span></p>
            <p><strong>Năm sinh:</strong> <span id="p-dob"></span></p>
        </div>

        <div id="error" class="hidden">
            <h3 style="color: #d32f2f;">Có lỗi xảy ra!</h3>
            <p id="error-msg">Không tìm thấy dữ liệu.</p>
            <a href="/vnbf/" style="display: inline-block; margin-top: 10px; text-decoration: none; color: blue;">&larr; Quay lại trang chủ</a>
        </div>

        <div id="debug" class="debug-box"></div>
    </div>

    <script>
        // --- CONFIGURATION ---
        // We explicitly set the repo name to avoid path confusion
        const REPO_NAME = "vnbf"; 
        // ---------------------

        function log(msg) {
            const debugEl = document.getElementById('debug');
            debugEl.style.display = 'block';
            debugEl.innerHTML += "> " + msg + "<br>";
            console.log(msg);
        }

        async function init() {
            try {
                // 1. Calculate the correct path to the JSON file
                // If we are at https://thanhchow.github.io/vnbf/athlete/123
                // We need https://thanhchow.github.io/vnbf/vnbf_data.json
                const origin = window.location.origin; // https://thanhchow.github.io
                const jsonUrl = `${origin}/${REPO_NAME}/vnbf_data.json`;
                
                log("Looking for data at: " + jsonUrl);

                // 2. Parse the Athlete ID from the current URL
                const path = window.location.pathname; // /vnbf/athlete/052095015204
                log("Current Path: " + path);
                
                const segments = path.split('/').filter(p => p.length > 0);
                const urlId = segments[segments.length - 1]; // 052095015204
                log("Detected ID: " + urlId);

                // 3. Fetch the data
                const response = await fetch(jsonUrl);
                
                if (!response.ok) {
                    throw new Error(`Failed to load file. Status: ${response.status}`);
                }
                
                const data = await response.json();
                log(`Database loaded: ${data.length} records.`);

                // 4. Find the person
                // We convert both to String to avoid number/string mismatches
                const person = data.find(p => String(p.id) === String(urlId));

                if (person) {
                    renderProfile(person, origin);
                } else {
                    document.getElementById('error-msg').innerText = `Không tìm thấy ID: ${urlId} trong dữ liệu.`;
                    showError();
                }

            } catch (err) {
                document.getElementById('error-msg').innerText = err.message;
                log("ERROR: " + err.message);
                showError();
            }
        }

        function renderProfile(person, origin) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('profile').classList.remove('hidden');

            document.getElementById('p-name').innerText = person.name;
            document.getElementById('p-id').innerText = person.id;
            document.getElementById('p-unit').innerText = person.unit || "---";
            document.getElementById('p-dob').innerText = person.dob || "---";

            // Role Badge
            const roleEl = document.getElementById('p-role');
            if (person.role === 'coach') roleEl.innerText = "Huấn Luyện Viên";
            else if (person.role === 'referee') roleEl.innerText = "Trọng Tài";
            else roleEl.innerText = "Vận Động Viên";

            // Image Path
            // We construct the absolute path to images
            if (person.image) {
                const imgUrl = `${origin}/${REPO_NAME}/images/${person.image}`;
                document.getElementById('p-img').src = imgUrl;
                log("Loading Image: " + imgUrl);
            }
        }

        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }

        init();
    </script>
</body>
</html>